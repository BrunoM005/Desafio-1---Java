public class ListaDuplamenteEncadeada {

    // Classe do nó (representa um item da lista)
    static class No {
        int valor;
        No proximo;
        No anterior;

        No(int valor) {
            this.valor = valor;
            this.proximo = null;
            this.anterior = null;
        }
    }

    // Classe da lista duplamente encadeada
    static class Lista {
        No cabeca; // Nó cabeçalho (nó fictício)
        
        // Construtor da lista (inicializa a lista com um nó cabeça)
        Lista() {
            cabeca = new No(0);  // Nó cabeça com valor 0 (ou qualquer valor que você escolher)
            cabeca.proximo = cabeca; // O nó cabeça aponta para ele mesmo
            cabeca.anterior = cabeca; // O nó cabeça aponta para ele mesmo
        }

        // Insere um valor no final da lista
        public void inserirFinal(int valor) {
            No novo = new No(valor);
            No ultimo = cabeca.anterior;  // O último nó é sempre o nó anterior ao nó cabeça

            // Ajustando os ponteiros
            ultimo.proximo = novo;
            novo.anterior = ultimo;
            novo.proximo = cabeca;  // O novo nó aponta para o nó cabeça
            cabeca.anterior = novo;  // O nó cabeça aponta para o novo nó
        }

        // Função que localiza o P-ésimo elemento na lista
        public No Locate(int P) {
            No atual = cabeca.proximo;  // Começa no primeiro nó após o cabeçalho
            int i = 1;  // A contagem começa a partir de 1 (posição 1 é o primeiro item)

            while (atual != cabeca) {  // Percorre até o nó cabeça
                if (i == P) {
                    return atual;  // Retorna o ponteiro para o nó da posição P
                }
                i++;
                atual = atual.proximo;
            }
            
            return null;  // Retorna NULL se não encontrar a posição P
        }

        // Exibe os elementos da lista da cabeça para o final
        public void exibir() {
            No atual = cabeca.proximo;
            while (atual != cabeca) {
                System.out.print(atual.valor + " ");
                atual = atual.proximo;
            }
            System.out.println();
        }

        // Exibe os elementos da lista do final para a cabeça
        public void exibirReverso() {
            No atual = cabeca.anterior;
            while (atual != cabeca) {
                System.out.print(atual.valor + " ");
                atual = atual.anterior;
            }
            System.out.println();
        }
    }

    public static void main(String[] args) {
        // Criando uma lista duplamente encadeada
        Lista lista = new Lista();

        // Inserindo elementos
        lista.inserirFinal(10);
        lista.inserirFinal(20);
        lista.inserirFinal(30);
        lista.inserirFinal(40);

        // Exibindo a lista
        System.out.print("Lista: ");
        lista.exibir();

        // Testando a função Locate
        int posicao = 3;
        No item = lista.Locate(posicao);
        if (item != null) {
            System.out.println("Elemento na posição " + posicao + ": " + item.valor);
        } else {
            System.out.println("Posição " + posicao + " não encontrada.");
        }
    }
}
